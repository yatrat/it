const c=document.getElementById('cityInput'),l=document.getElementById('cityList'),d=document.getElementById('daysSelect'),g=document.getElementById('generateBtn'),r=document.getElementById('itineraryResults'),u='yatrat',p='it',b='main',C=`https://cdn.jsdelivr.net/gh/yatrat/it@v2.4/data/citylist.json`,I=`https://cdn.jsdelivr.net/gh/yatrat/it@v2.4/data/itinerary-data.json`;document.addEventListener('DOMContentLoaded',()=>{console.log('Travel Itinerary Tool Loaded'),i(),g&&g.addEventListener('click',a),c&&c.addEventListener('keypress',e=>{'Enter'===e.key&&a()})});async function i(){if(!c||!l)return;if(c.a)return;c.a=!0;try{const e=await fetch(C),t=(await e.json()).cities||[];c.oninput=function(){const e=this.value.toLowerCase().trim();l.innerHTML='';if(!e)return l.style.display='none';const o=[],n={};t.forEach(t=>{t.name.toLowerCase().includes(e)&&!n[t.name]&&(n[t.name]=!0,o.push(t))});if(o.length){o.slice(0,8).forEach(e=>{const t=document.createElement('div');t.className='yt-suggestion',t.textContent=e.name,t.onclick=()=>{c.value=e.name,c.dataset.cityId=e.id,l.style.display='none'},l.appendChild(t)});l.style.display='block'}else l.innerHTML='<div class="yt-suggestion">No cities found</div>',l.style.display='block'}}catch(e){console.error('Failed:',e)}}async function o(){try{return await(await fetch(I)).json()}catch(e){return console.error('Failed:',e),{cities:{}}}}async function a(){if(!c||!d||!r)return;const e=c.value.trim(),t=c.dataset.cityId||e.toLowerCase(),o=parseInt(d.value);if(!e||!o)return void s('Please select both city and number of days','error');g&&(g.innerHTML='Loading...',g.disabled=!0);try{const n=await o();if(!n.cities||!n.cities[t])return void s(`Itinerary not available for ${e}`,'error');const i=n.cities[t],a=[];for(let n=1;n<=o;n++){const o=i.plans[n.toString()];o&&Array.isArray(o)&&o.forEach(e=>{a.push({day:n,activity:e})})}if(0===a.length)return void s(`${o}-day itinerary not available for ${e}`,'error');u(e,o,a)}catch(e){console.error('Error:',e),s('Failed to generate itinerary','error')}finally{g&&(g.innerHTML='Generate Plan',g.disabled=!1)}}function u(e,t,o){if(!r)return;r.innerHTML='';const n=document.createElement('div');n.className='itinerary-header',n.innerHTML=`<h3>${t}-Day Itinerary for ${e}</h3><p>${o.length} activities across ${t} days</p>`,r.appendChild(n);const i={};o.forEach(e=>{(i[e.day]||(i[e.day]=[])).push(e.activity)});for(let n=1;n<=t;n++)if(i[n]){const e=document.createElement('div');e.className='itinerary-day',e.innerHTML=`<div class="day-header"><span class="day-number">Day ${n}</span><span class="day-duration">${i[n].length} activities</span></div><ul class="day-activities">${i[n].map(e=>`<li>${e}</li>`).join('')}</ul>`,r.appendChild(e)}const a=Object.keys(i).length;t>a&&(e=t-a,n=document.createElement('div'),n.className='itinerary-warning',n.innerHTML=`<p><strong>Travel Tip:</strong> Detailed itinerary available for ${a} days. You can use the remaining ${e} day(s) for free exploration or relaxation.</p>`,r.appendChild(n))}function s(e,t='error'){r&&(r.innerHTML=`<div class="message ${t}">${e}</div>`)}
